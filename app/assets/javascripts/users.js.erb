var playlist;

$(function() {
	playlist = new jPlayerPlaylist(
		{
			jPlayer: "#jquery_jplayer",
			cssSelectorAncestor: "#jp_container"
		},
		[
			// Empty playlist
		],
		{
			playlistOptions: { enableRemoveControls: true },
			swfPath: "<%= asset_path 'Jplayer.swf' %>",
			supplied: "mp3",
			wmode: "window"
		}
	);

	$("#play").on("click", function() {
		var ids = $("input[name='songs[]']:checked").map(function() {
			return this.value;
		}).get();

		$.getJSON("/music", { "song_ids": ids }, function(data) {
			$.each(data.songs, function(index, song) {
				playlist.add({
					title: song.title,
					artist: song.artist,
					mp3: song.url
				});
			});
			playlist.play();
		});
	});

	$("#search_form").submit(function() {
		$.get(this.action, $(this).serialize(), null, "script");
		return false;
	});

	$("#search_form input").keyup(function() {
		$.get($("#search_form").action, $("#search_form").serialize(), null, "script");
		return false;
	});

	$("#check_all").click(function() {
		var checked = this.checked;
		$('input[name="songs[]"]').each(function() {
			this.checked = checked;
		});
	});
});